"""Add transactions, transaction_shares, expense_categories tables

Revision ID: 93c167e14543
Revises: b322c84267dc
Create Date: 2025-06-23 20:08:48.513571

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '93c167e14543'
down_revision: Union[str, None] = 'b322c84267dc'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('expense_categories',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(), nullable=False, comment="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 'Ð•Ð´Ð°')"),
    sa.Column('icon', sa.String(), nullable=True, comment="Ð˜ÐºÐ¾Ð½ÐºÐ° Ð¸Ð»Ð¸ emoji ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 'ðŸ•' Ð¸Ð»Ð¸ 'food')"),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_expense_categories_id'), 'expense_categories', ['id'], unique=False)
    op.create_table('friends',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('friend_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['friend_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'friend_id', name='_user_friend_uc')
    )
    op.create_index(op.f('ix_friends_id'), 'friends', ['id'], unique=False)
    op.create_table('transactions',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('group_id', sa.Integer(), nullable=False, comment='ID Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹, Ðº ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ'),
    sa.Column('created_by', sa.Integer(), nullable=False, comment='ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ, ÑÐ¾Ð·Ð´Ð°Ð²ÑˆÐ¸Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ'),
    sa.Column('type', sa.String(), nullable=False, comment="'expense' â€” Ñ€Ð°ÑÑ…Ð¾Ð´, 'transfer' â€” Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ (Ñ‚Ñ€Ð°Ð½Ñˆ)"),
    sa.Column('amount', sa.Float(), nullable=False, comment='Ð¡ÑƒÐ¼Ð¼Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸'),
    sa.Column('date', sa.DateTime(), nullable=False, comment='Ð”Ð°Ñ‚Ð° Ñ€Ð°ÑÑ…Ð¾Ð´Ð°/Ñ‚Ñ€Ð°Ð½ÑˆÐ°'),
    sa.Column('comment', sa.String(), nullable=True, comment='ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹ Ð¸Ð»Ð¸ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ'),
    sa.Column('category_id', sa.Integer(), nullable=True, comment="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ñ€Ð°ÑÑ…Ð¾Ð´Ð° (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ type='expense')"),
    sa.Column('paid_by', sa.Integer(), nullable=True, comment='ÐšÑ‚Ð¾ Ð¾Ð¿Ð»Ð°Ñ‚Ð¸Ð» (Ð´Ð»Ñ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²)'),
    sa.Column('split_type', sa.String(), nullable=True, comment="Ð¢Ð¸Ð¿ Ð´ÐµÐ»ÐµÐ½Ð¸Ñ ('equal', 'shares', 'custom')"),
    sa.Column('transfer_from', sa.Integer(), nullable=True, comment="ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÐ»ÑŒ Ð´ÐµÐ½ÐµÐ³ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ type='transfer')"),
    sa.Column('transfer_to', sa.JSON(), nullable=True, comment='Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¹ (user_id), Ð´Ð»Ñ transfer â€” Ð¾Ð´Ð¸Ð½ Ð¸Ð»Ð¸ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾, JSON-Ð¼Ð°ÑÑÐ¸Ð²'),
    sa.Column('created_at', sa.DateTime(), nullable=False, comment='Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ'),
    sa.Column('updated_at', sa.DateTime(), nullable=False, comment='Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ'),
    sa.Column('currency', sa.String(), nullable=True, comment='Ð’Ð°Ð»ÑŽÑ‚Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸, Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ RUB'),
    sa.Column('is_deleted', sa.Boolean(), nullable=True, comment='ÐŸÑ€Ð¸Ð·Ð½Ð°Ðº soft delete (Ð°Ñ€Ñ…Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ)'),
    sa.Column('receipt_url', sa.String(), nullable=True, comment='Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° Ñ„Ð°Ð¹Ð» Ñ‡ÐµÐºÐ° (ÐµÑÐ»Ð¸ Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½)'),
    sa.Column('receipt_data', sa.JSON(), nullable=True, comment='Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð²Ð°Ð½Ð¸Ñ Ñ‡ÐµÐºÐ° (Ð¼Ð°ÑÑÐ¸Ð² Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð², Ð¸Ñ‚Ð¾Ð³ Ð¸ Ñ‚.Ð´.)'),
    sa.ForeignKeyConstraint(['category_id'], ['expense_categories.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['group_id'], ['groups.id'], ),
    sa.ForeignKeyConstraint(['paid_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['transfer_from'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_transactions_id'), 'transactions', ['id'], unique=False)
    op.create_table('transaction_shares',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('transaction_id', sa.Integer(), nullable=False, comment='ID Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸'),
    sa.Column('user_id', sa.Integer(), nullable=False, comment='Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸Ðº Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹'),
    sa.Column('amount', sa.Float(), nullable=False, comment='Ð¡ÑƒÐ¼Ð¼Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÑ‚Ð¾Ñ‚ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸Ðº'),
    sa.Column('shares', sa.Integer(), nullable=True, comment="ÐšÐ¾Ð»-Ð²Ð¾ Ð´Ð¾Ð»ÐµÐ¹ (ÐµÑÐ»Ð¸ split_type='shares')"),
    sa.ForeignKeyConstraint(['transaction_id'], ['transactions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_transaction_shares_id'), 'transaction_shares', ['id'], unique=False)
    op.create_index(op.f('ix_group_members_id'), 'group_members', ['id'], unique=False)
    op.create_index(op.f('ix_groups_id'), 'groups', ['id'], unique=False)
    op.create_index(op.f('ix_groups_name'), 'groups', ['name'], unique=False)
    op.create_index(op.f('ix_users_id'), 'users', ['id'], unique=False)
    op.create_index(op.f('ix_users_name'), 'users', ['name'], unique=False)
    op.create_index(op.f('ix_users_telegram_id'), 'users', ['telegram_id'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_users_telegram_id'), table_name='users')
    op.drop_index(op.f('ix_users_name'), table_name='users')
    op.drop_index(op.f('ix_users_id'), table_name='users')
    op.drop_index(op.f('ix_groups_name'), table_name='groups')
    op.drop_index(op.f('ix_groups_id'), table_name='groups')
    op.drop_index(op.f('ix_group_members_id'), table_name='group_members')
    op.drop_index(op.f('ix_transaction_shares_id'), table_name='transaction_shares')
    op.drop_table('transaction_shares')
    op.drop_index(op.f('ix_transactions_id'), table_name='transactions')
    op.drop_table('transactions')
    op.drop_index(op.f('ix_friends_id'), table_name='friends')
    op.drop_table('friends')
    op.drop_index(op.f('ix_expense_categories_id'), table_name='expense_categories')
    op.drop_table('expense_categories')
    # ### end Alembic commands ###
